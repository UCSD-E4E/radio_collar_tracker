#include <stdio.h>
#include <time.h>
#include <unistd.h>
#include <stdint.h>

int main(int argc, char** argv){
	int num_files = 100000;
	struct timespec start_time;
	struct timespec end_time;
	FILE* fileptr;
	uint64_t avg_time = 0;
	uint64_t close_time = 0;

	for(int i = 0; i < num_files; i++){
		clock_gettime(CLOCK_REALTIME, &start_time);
		fileptr = fopen("/media/RAW_DATA/rct/test", "ab");
		clock_gettime(CLOCK_REALTIME, &end_time);
		uint64_t start_ms = (long) start_time.tv_sec * 1e9 + (long)(start_time.tv_nsec / 1.0e0);
		uint64_t end_ms = (long) end_time.tv_sec * 1e9 + (long)(end_time.tv_nsec / 1.0e0);
		avg_time += end_ms - start_ms;

		clock_gettime(CLOCK_REALTIME, &start_time);
		fclose(fileptr);
		clock_gettime(CLOCK_REALTIME, &end_time);
		start_ms = (long)start_time.tv_sec * 1e9 + start_time.tv_nsec;
		end_ms = (long)end_time.tv_sec * 1e9 + end_time.tv_nsec;
		close_time += end_ms - start_ms;
	}
	printf("Average open time (ns): %ld\n", (long)(avg_time / (float)num_files));
	printf("Average close time (ns): %ld\n", (long)(close_time / (float)num_files));
	return 0;
}
